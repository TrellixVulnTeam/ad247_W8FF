{"version":3,"sources":["../../src/plugins/file-download.js"],"names":["CHUNK_SIZE","downloadFilePart","location","chunkNum","telegram","args","offset","limit","getLocation","doc","_","id","access_hash","parts","Math","ceil","size","results","Array","i","response","bytes","Uint8Array","downloadDocument"],"mappings":";;AAEA,IAAMA,aAAa,KAAnB;;AAWA,IAAMC,mBAAmB,CACvBC,QADuB,EAEvBC,WAAmB,CAFI,EAGvBC,QAHuB,KAIpB;AACH,MAAMC,OAAO;AACXH,YADW;AAEXI,YAAQN,aAAaG,QAFV;AAGXI,WAAQP;AAHG,GAAb;AAKA,SAAOI,SAAS,gBAAT,EAA2BC,IAA3B,CAAP;AACD,CAXD;;AAaA,IAAMG,cAAeC,GAAD,KAAsB;AACxCC,KAAa,wBAD2B;AAExCC,MAAaF,IAAIE,EAFuB;AAGxCC,eAAaH,IAAIG;AAHuB,CAAtB,CAApB;;AAMyB,gBAAOH,GAAP,EAAwBL,QAAxB,EAAqC;AAC5D,MAAMF,WAAWM,YAAYC,GAAZ,CAAjB;AACA,MAAMI,QAAQC,KAAKC,IAAL,CAAUN,IAAIO,IAAJ,GAAWhB,UAArB,CAAd;AACA,MAAMiB,UAA2BC,MAAML,KAAN,CAAjC;AACA,OAAK,IAAIM,IAAI,CAAb,EAAgBA,IAAIN,KAApB,EAA2BM,GAA3B,EAAgC;AAC9B,QAAMC,WAAW,MAAMnB,iBAAiBC,QAAjB,EAA2BiB,CAA3B,EAA8Bf,QAA9B,CAAvB;AACAa,YAAQE,CAAR,IAAaC,SAASC,KAAtB;AACD;AACD,SAAO,IAAIC,UAAJ,CAAe,CAAC,GAAGL,OAAJ,CAAf,CAAP;AACD;;AATD,IAAMM;AAAA;;AAAA;AAAA;AAAA;AAAA,IAAN;;AAWA,eAAeA,gBAAf","file":"file-download.js","sourcesContent":["//@flow\n\nconst CHUNK_SIZE = 10240\n\ntype MTDocument = {\n  _: 'document',\n  id: number,\n  access_hash: string,\n  mime_type: 'video/mp4',\n  size: number,\n  dc_id: number,\n}\n\nconst downloadFilePart = (\n  location,\n  chunkNum: number = 0,\n  telegram\n) => {\n  const args = {\n    location,\n    offset: CHUNK_SIZE * chunkNum,\n    limit : CHUNK_SIZE,\n  }\n  return telegram('upload.getFile', args)\n}\n\nconst getLocation = (doc: MTDocument) => ({\n  _          : 'inputVideoFileLocation',\n  id         : doc.id,\n  access_hash: doc.access_hash\n})\n\nconst downloadDocument = async (doc: MTDocument, telegram) => {\n  const location = getLocation(doc)\n  const parts = Math.ceil(doc.size / CHUNK_SIZE)\n  const results: Array<number[]> = Array(parts)\n  for (let i = 0; i < parts; i++) {\n    const response = await downloadFilePart(location, i, telegram)\n    results[i] = response.bytes\n  }\n  return new Uint8Array([...results])\n}\n\nexport default downloadDocument\n"]}