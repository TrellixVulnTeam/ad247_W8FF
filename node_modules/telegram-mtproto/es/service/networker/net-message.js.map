{"version":3,"sources":["../../../src/service/networker/net-message.js"],"names":["forEachObjIndexed","generateID","blueDefer","NetMessage","constructor","uid","seq_no","body","acked","container","notContentRelated","createNetworker","longPoll","copyHelper","value","key","msg_id","Object","defineProperty","enumerable","configurable","writable","copyOptions","options","size","Uint8Array","byteLength","length","clone","dc","copy","result","toJSON","deferred","requestID","noShedule","NetContainer","inner","orig","isAPI","dcID","resultType"],"mappings":"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","file":"net-message.js","sourcesContent":["//@flow\n\nimport { forEachObjIndexed } from 'ramda'\n\nimport { generateID } from '../time-manager'\nimport blueDefer from '../../util/defer'\nimport { type Defer } from '../../util/defer'\n\ntype BodyBytes = number[] | Uint8Array\n\nexport class NetMessage {\n  uid: string\n  body: BodyBytes\n  seq_no: number\n  isAPI: boolean\n  acked: boolean = false\n  msg_id: string\n  container: boolean = false\n  notContentRelated: boolean = false\n  deferred: Defer\n  requestID: ?string\n  dc: ?number\n  dcID: ?number\n  noShedule: ?boolean\n  resultType: ?string\n  createNetworker: boolean = false\n  longPoll: boolean = false\n  constructor(uid: string, seq_no: number, body: BodyBytes) {\n    this.uid = uid\n    this.msg_id = generateID(uid)\n    this.seq_no = seq_no\n    // this.body = body\n    Object.defineProperty(this, 'body', {\n      enumerable  : false,\n      configurable: true,\n      writable    : true,\n      value       : body\n    })\n    Object.defineProperty(this, 'deferred', {\n      enumerable  : false,\n      configurable: true,\n      writable    : true,\n      value       : blueDefer()\n    })\n    Object.defineProperty(this, 'copyHelper', {\n      enumerable  : false,\n      configurable: true,\n      writable    : true,\n      value       : this.copyHelper\n    })\n  }\n  copyOptions(options: Object) { //TODO remove this\n    forEachObjIndexed(this.copyHelper, options)\n  }\n  copyHelper = (value: any, key: string) => {\n    //$FlowIssue\n    this[key] = value\n  }\n  size() {\n    if (this.body instanceof Uint8Array)\n      return this.body.byteLength\n    else\n      return this.body.length\n  }\n  clone(seq_no: number, dc: number/* | '@@home'*/): NetMessage {\n    const copy = new NetMessage(this.uid, seq_no, this.body)\n    const result = clone(this, copy, dc)\n    return result\n  }\n  toJSON() {\n    return {\n      uid      : this.uid,\n      deferred : this.deferred,\n      requestID: this.requestID,\n      noShedule: this.noShedule,\n\n    }\n  }\n}\n\nexport class NetContainer extends NetMessage {\n  inner: string[]\n  constructor(uid: string, seq_no: number, body: BodyBytes, inner: string[]) {\n    super(uid, seq_no, body)\n    this.container = true\n    this.inner = inner\n  }\n  clone(seq_no: number, dc: number/* | '@@home'*/): NetContainer {\n    const copy = new NetContainer(this.uid, seq_no, this.body, this.inner)\n    const result = clone(this, copy, dc)\n    return result\n  }\n}\n\nfunction clone <+T: NetMessage>(orig: T, copy: T, dc: number): T {\n  copy.dc = dc\n  copy.isAPI = orig.isAPI\n  copy.notContentRelated = orig.notContentRelated\n  copy.deferred = orig.deferred\n  copy.acked = orig.acked\n  copy.noShedule = orig.noShedule\n  copy.createNetworker = orig.createNetworker\n  copy.dcID = orig.dcID\n  copy.resultType = orig.resultType\n  return copy\n}\n\nexport type {\n  NetMessage as NetMessageType,\n  NetContainer as NetContainerType\n}\n"]}